<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ãƒ¦ãƒ³ã¨ãƒªãƒ³ã®å†’é™º</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; touch-action:manipulation; }
  body {
    background: linear-gradient(135deg, #0a0015 0%, #1a0030 100%);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 100vh; font-family: 'Zen Maru Gothic', sans-serif; overflow: hidden;
  }
  #gameTitle {
    color: #fff; font-size: 1.4rem; font-weight: 900; letter-spacing: 0.15em;
    margin-bottom: 4px; text-shadow: 0 0 20px #ff80ff, 0 0 40px #ff00ff;
  }
  #scoreBar {
    display: flex; gap: 16px; margin-bottom: 4px;
    color: #fff; font-size: 0.82rem; font-weight: 700; flex-wrap: wrap; justify-content: center;
  }
  #scoreDisplay { color: #ffdd00; text-shadow: 0 0 10px #ffaa00; }
  #activeChar   { color: #80ffff; text-shadow: 0 0 10px #00ffff; }
  #jumpScore    { color: #88ff88; text-shadow: 0 0 8px #00ff00; }
  #dodgeScore   { color: #ffaa44; text-shadow: 0 0 8px #ff8800; }

  #gameCanvas {
    border: 2px solid #ff00ff; border-radius: 12px;
    box-shadow: 0 0 30px #ff00ff88, 0 0 60px #8800ff44; max-width: 100%;
  }
  #controls { display: flex; gap: 20px; margin-top: 8px; align-items: center; }
  .btn-group { display: flex; gap: 8px; }
  .ctrl-btn {
    width: 60px; height: 60px; border-radius: 50%; border: 2px solid #ff80ff;
    background: rgba(255,0,255,0.2); color: #fff; font-size: 1.4rem; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    user-select: none; -webkit-user-select: none; box-shadow: 0 0 10px #ff00ff44;
  }
  .ctrl-btn:active, .ctrl-btn.pressed { background: rgba(255,0,255,0.6); }
  #jumpBtn { width:70px; height:70px; background:rgba(0,200,255,0.2); border-color:#00ffff; font-size:1.6rem; }
  #jumpBtn:active, #jumpBtn.pressed { background: rgba(0,200,255,0.6); }

  .overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.88);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: #fff; z-index: 10;
  }
  .overlay.hidden { display: none; }
  .overlay h2 { font-size: 1.8rem; font-weight: 900; margin-bottom: 8px; text-shadow: 0 0 20px #ff00ff; }
  .overlay p { font-size: 0.95rem; color: #ccc; margin-bottom: 14px; text-align: center; }

  #charSelect { display: flex; gap: 24px; margin-bottom: 20px; }
  .charCard {
    width: 120px; padding: 14px 10px; border-radius: 16px; border: 2px solid #666;
    background: rgba(255,255,255,0.05); cursor: pointer; text-align: center; transition: all 0.2s;
  }
  .charCard:hover { border-color:#ff80ff; background:rgba(255,0,255,0.15); transform:scale(1.05); }
  .charCard.selected { border-color:#ffdd00; background:rgba(255,220,0,0.15); box-shadow:0 0 20px #ffdd0066; }
  .charCard .charName { font-size:1.1rem; font-weight:900; margin-top:6px; }
  .charCard .charDesc { font-size:0.72rem; color:#aaa; margin-top:3px; }
  .charCard .charHi  { font-size:0.75rem; margin-top:6px; color:#ffdd00; font-weight:700; }
  .charFace { font-size: 2.6rem; }

  /* ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ */
  #hiTable { display:flex; gap:20px; margin-bottom:16px; }
  .hiBox {
    padding:10px 18px; border-radius:12px; text-align:center;
    border:2px solid #444; background:rgba(255,255,255,0.05);
  }
  .hiBox .hiName { font-size:1rem; font-weight:900; }
  .hiBox .hiVal  { font-size:1.3rem; font-weight:900; color:#ffdd00; margin-top:4px; }

  .scoreDetail { font-size:0.85rem; color:#ccc; margin-bottom:4px; }

  .big-btn {
    padding:13px 38px; background:linear-gradient(135deg,#ff00ff,#8800ff);
    border:none; border-radius:50px; color:#fff; font-size:1.05rem;
    font-weight:700; font-family:'Zen Maru Gothic',sans-serif; cursor:pointer;
    box-shadow:0 0 20px #ff00ff88; letter-spacing:0.1em; margin-top:6px;
  }
  .big-btn:disabled { opacity:0.4; cursor:default; }
  .big-btn.secondary {
    background:linear-gradient(135deg,#444,#222); box-shadow:none;
    font-size:0.9rem; padding:10px 28px; margin-top:8px;
  }

  /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤ºï¼‰ */
  #popups { position:absolute; pointer-events:none; }
</style>
</head>
<body>

<div id="gameTitle">âœ¨ ãƒ¦ãƒ³ã¨ãƒªãƒ³ã®å†’é™º âœ¨</div>
<div id="scoreBar">
  <span id="scoreDisplay">ã‚¹ã‚³ã‚¢: 0</span>
  <span id="activeChar">ã‚­ãƒ£ãƒ©: -</span>
  <span id="jumpScore">ã‚¸ãƒ£ãƒ³ãƒ—: +0</span>
  <span id="dodgeScore">å›é¿: +0</span>
</div>

<canvas id="gameCanvas" width="360" height="300"></canvas>

<div id="controls">
  <div class="btn-group">
    <div class="ctrl-btn" id="leftBtn">â—€</div>
    <div class="ctrl-btn" id="rightBtn">â–¶</div>
  </div>
  <div class="ctrl-btn" id="jumpBtn">â†‘</div>
</div>

<!-- ã‚­ãƒ£ãƒ©é¸æŠç”»é¢ -->
<div class="overlay" id="selectOverlay">
  <h2>âœ¨ ãƒ¦ãƒ³ã¨ãƒªãƒ³ã®å†’é™º âœ¨</h2>
  <p>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸ã‚“ã§ãã ã•ã„ï¼<br><span style="font-size:0.8rem;color:#aaa">æ•µã‚’é¿ã‘ã‚‹ã¨å›é¿ãƒœãƒ¼ãƒŠã‚¹ï¼ã‚¸ãƒ£ãƒ³ãƒ—ã§ã‚‚ç‚¹æ•°GETï¼</span></p>
  <div id="charSelect">
    <div class="charCard" id="card0" onclick="selectChar(0)">
      <div class="charFace">ğŸ§‘</div>
      <div class="charName" style="color:#ff6688">ãƒ¦ãƒ³</div>
      <div class="charDesc">ç¾ç”·å­<br>ã‹ã£ã“ã„ã„ï¼</div>
      <div class="charHi" id="hi0">ãƒ™ã‚¹ãƒˆ: 0ç‚¹</div>
    </div>
    <div class="charCard" id="card1" onclick="selectChar(1)">
      <div class="charFace">ğŸ‘¦</div>
      <div class="charName" style="color:#66aaff">ãƒªãƒ³</div>
      <div class="charDesc">ç¾å°‘å¹´<br>ã‹ã‚ã„ã„ï¼</div>
      <div class="charHi" id="hi1">ãƒ™ã‚¹ãƒˆ: 0ç‚¹</div>
    </div>
  </div>
  <button class="big-btn" id="startBtn" disabled onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
</div>

<!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ -->
<div class="overlay hidden" id="gameoverOverlay">
  <h2>ğŸ’¥ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼</h2>
  <div id="hiTable">
    <div class="hiBox">
      <div class="hiName" style="color:#ff6688">ğŸ§‘ ãƒ¦ãƒ³</div>
      <div class="hiVal" id="goHi0">0ç‚¹</div>
    </div>
    <div class="hiBox">
      <div class="hiName" style="color:#66aaff">ğŸ‘¦ ãƒªãƒ³</div>
      <div class="hiVal" id="goHi1">0ç‚¹</div>
    </div>
  </div>
  <p class="scoreDetail" id="goDetail"></p>
  <p id="goNew" style="color:#ffdd00;font-weight:900;font-size:1rem;margin-bottom:8px;"></p>
  <button class="big-btn" onclick="backToSelect()">ã‚­ãƒ£ãƒ©é¸æŠã«æˆ»ã‚‹</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const GROUND = H - 50;

const CHARS = [
  { name: 'ãƒ¦ãƒ³', color: '#ff6688', hairColor: '#330011', accentColor: '#ffaacc' },
  { name: 'ãƒªãƒ³', color: '#66aaff', hairColor: '#001133', accentColor: '#aaddff' }
];

// ãƒã‚¤ã‚¹ã‚³ã‚¢è¨˜éŒ²
const highScores = [0, 0];

let selectedChar = -1;
let gameRunning = false;
let player, enemies, platforms, stars, scrollX, frameCount, jumpUsed;
let score, timeScore, jumpTotal, dodgeTotal;
let popups = []; // ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤ºç”¨
const keys = { left: false, right: false, jump: false };
let wasJumping = false;
let enemyPassX = []; // å›é¿ã‚«ã‚¦ãƒ³ãƒˆç”¨ï¼ˆæ•µãŒé€šéã—ãŸã‹ï¼‰

const GRAVITY = 0.5, SPEED = 3, JUMP_FORCE = -11;
const JUMP_BONUS = 3;   // ã‚¸ãƒ£ãƒ³ãƒ—1å›ã‚ãŸã‚Šã®ç‚¹æ•°
const DODGE_BONUS = 10; // å›é¿1å›ã‚ãŸã‚Šã®ç‚¹æ•°

function updateHiDisplay() {
  document.getElementById('hi0').textContent = `ãƒ™ã‚¹ãƒˆ: ${highScores[0]}ç‚¹`;
  document.getElementById('hi1').textContent = `ãƒ™ã‚¹ãƒˆ: ${highScores[1]}ç‚¹`;
}

function selectChar(idx) {
  selectedChar = idx;
  document.getElementById('card0').classList.toggle('selected', idx === 0);
  document.getElementById('card1').classList.toggle('selected', idx === 1);
  document.getElementById('startBtn').disabled = false;
}

function startGame() {
  if (selectedChar < 0) return;
  document.getElementById('selectOverlay').classList.add('hidden');

  score = 0; timeScore = 0; jumpTotal = 0; dodgeTotal = 0;
  scrollX = 0; frameCount = 0; jumpUsed = false; wasJumping = false;
  enemies = []; stars = []; popups = []; enemyPassX = [];

  player = { x: 80, y: GROUND, vy: 0, onGround: true };

  platforms = [
    { x: 200, y: GROUND - 60, w: 80, h: 12 },
    { x: 380, y: GROUND - 80, w: 70, h: 12 },
    { x: 550, y: GROUND - 55, w: 90, h: 12 },
    { x: 720, y: GROUND - 90, w: 60, h: 12 },
  ];

  for (let i = 0; i < 40; i++) {
    stars.push({ x: Math.random() * W * 4, y: Math.random() * (H - 80), size: Math.random() * 2 + 0.5, tw: Math.random() * Math.PI * 2 });
  }

  document.getElementById('activeChar').textContent = `ã‚­ãƒ£ãƒ©: ${CHARS[selectedChar].name}`;
  updateScoreBar();
  gameRunning = true;
}

function backToSelect() {
  gameRunning = false;
  document.getElementById('gameoverOverlay').classList.add('hidden');
  document.getElementById('selectOverlay').classList.remove('hidden');
  updateHiDisplay();
}

function addPopup(text, color, x, y) {
  popups.push({ text, color, x, y, life: 60, vy: -1 });
}

function updateScoreBar() {
  document.getElementById('scoreDisplay').textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
  document.getElementById('jumpScore').textContent = `ã‚¸ãƒ£ãƒ³ãƒ—: +${jumpTotal}`;
  document.getElementById('dodgeScore').textContent = `å›é¿: +${dodgeTotal}`;
}

function update() {
  if (!gameRunning) return;
  frameCount++;

  // ç§»å‹•
  if (keys.left)  player.x -= SPEED;
  if (keys.right) player.x += SPEED;

  // ã‚¸ãƒ£ãƒ³ãƒ—
  const isJumping = keys.jump;
  if (isJumping && player.onGround && !jumpUsed) {
    player.vy = JUMP_FORCE;
    player.onGround = false;
    jumpUsed = true;
    // ã‚¸ãƒ£ãƒ³ãƒ—ãƒœãƒ¼ãƒŠã‚¹
    jumpTotal += JUMP_BONUS;
    score += JUMP_BONUS;
    addPopup(`+${JUMP_BONUS} ã‚¸ãƒ£ãƒ³ãƒ—ï¼`, '#88ff88', player.x - scrollX, player.y - 40);
  }
  if (!isJumping) jumpUsed = false;
  wasJumping = isJumping;

  player.vy += GRAVITY;
  player.y += player.vy;

  player.onGround = false;
  if (player.y >= GROUND) { player.y = GROUND; player.vy = 0; player.onGround = true; }

  platforms.forEach(pl => {
    const px = pl.x - scrollX;
    if (player.x + 12 > px && player.x - 12 < px + pl.w && player.vy > 0 &&
        player.y <= pl.y + 10 && player.y + player.vy >= pl.y - 10) {
      player.y = pl.y; player.vy = 0; player.onGround = true;
    }
  });

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  const sxPos = player.x - scrollX;
  if (sxPos > W * 0.6) scrollX += SPEED;
  if (sxPos < W * 0.3 && scrollX > 0) scrollX -= SPEED;
  if (player.x < scrollX + 10) player.x = scrollX + 10;

  // æ™‚é–“ã‚¹ã‚³ã‚¢ï¼ˆ30ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«1ç‚¹ï¼‰
  if (frameCount % 30 === 0) { timeScore++; score++; }

  // æ•µç”Ÿæˆ
  if (frameCount % 110 === 0) {
    const eid = frameCount;
    enemies.push({ x: scrollX + W + 40, y: GROUND, speed: 1.5 + Math.random() * 1.5, id: eid, passed: false });
  }

  // æ•µæ›´æ–°
  let gameOverFlag = false;
  enemies = enemies.filter(e => {
    e.x -= e.speed;

    // è¡çªåˆ¤å®š
    if (Math.abs(player.x - e.x) < 22 && Math.abs(player.y - e.y) < 26) {
      gameOverFlag = true;
      return false;
    }

    // å›é¿åˆ¤å®šï¼ˆæ•µãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é€šéã—ãŸã‚‰å›é¿æˆåŠŸï¼‰
    if (!e.passed && e.x < player.x - 30) {
      e.passed = true;
      dodgeTotal += DODGE_BONUS;
      score += DODGE_BONUS;
      addPopup(`+${DODGE_BONUS} å›é¿ï¼`, '#ffaa44', player.x - scrollX, player.y - 40);
    }

    return e.x > scrollX - 60;
  });

  if (gameOverFlag) { doGameOver(); return; }

  // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ›´æ–°
  popups = popups.filter(p => {
    p.y += p.vy; p.life--;
    return p.life > 0;
  });

  updateScoreBar();
}

function doGameOver() {
  gameRunning = false;
  const isNew = score > highScores[selectedChar];
  if (isNew) highScores[selectedChar] = score;

  document.getElementById('goHi0').textContent = `${highScores[0]}ç‚¹`;
  document.getElementById('goHi1').textContent = `${highScores[1]}ç‚¹`;
  document.getElementById('goDetail').textContent =
    `æ™‚é–“: +${timeScore}ç‚¹ ï¼ ã‚¸ãƒ£ãƒ³ãƒ—: +${jumpTotal}ç‚¹ ï¼ å›é¿: +${dodgeTotal}ç‚¹`;
  document.getElementById('goNew').textContent = isNew ? 'ğŸ‰ NEW ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼' : '';
  document.getElementById('gameoverOverlay').classList.remove('hidden');
}

function drawPlayer() {
  const c = CHARS[selectedChar];
  const sx = player.x - scrollX, sy = player.y;
  ctx.save();
  ctx.fillStyle = c.color;
  ctx.beginPath(); ctx.roundRect(sx - 10, sy - 28, 20, 20, 4); ctx.fill();
  ctx.fillStyle = '#ffe0b0';
  ctx.beginPath(); ctx.arc(sx, sy - 36, 12, 0, Math.PI * 2); ctx.fill();
  ctx.fillStyle = c.hairColor;
  ctx.beginPath();
  if (selectedChar === 0) {
    ctx.ellipse(sx, sy - 45, 13, 8, 0, Math.PI, 0);
  } else {
    ctx.ellipse(sx, sy - 46, 12, 7, 0, Math.PI, 0);
    ctx.arc(sx - 12, sy - 40, 5, 0, Math.PI * 2);
    ctx.arc(sx + 12, sy - 40, 5, 0, Math.PI * 2);
  }
  ctx.fill();
  ctx.fillStyle = '#333';
  ctx.beginPath();
  ctx.arc(sx - 4, sy - 37, 2, 0, Math.PI * 2);
  ctx.arc(sx + 4, sy - 37, 2, 0, Math.PI * 2);
  ctx.fill();
  ctx.strokeStyle = '#333'; ctx.lineWidth = 1.5;
  ctx.beginPath(); ctx.arc(sx, sy - 33, 4, 0.2, Math.PI - 0.2); ctx.stroke();
  ctx.fillStyle = c.accentColor;
  ctx.fillRect(sx - 8, sy - 10, 7, 12);
  ctx.fillRect(sx + 1, sy - 10, 7, 12);
  ctx.strokeStyle = c.color; ctx.lineWidth = 2;
  ctx.globalAlpha = 0.5 + 0.5 * Math.abs(Math.sin(frameCount * 0.1));
  ctx.beginPath(); ctx.arc(sx, sy - 36, 17, 0, Math.PI * 2); ctx.stroke();
  ctx.globalAlpha = 1;
  ctx.fillStyle = c.color; ctx.font = 'bold 11px sans-serif'; ctx.textAlign = 'center';
  ctx.fillText(c.name, sx, sy - 56);
  ctx.restore();
}

function drawEnemy(e) {
  const sx = e.x - scrollX;
  ctx.save();
  ctx.fillStyle = '#ff2200';
  ctx.beginPath(); ctx.arc(sx, e.y - 15, 14, 0, Math.PI * 2); ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.arc(sx - 5, e.y - 18, 4, 0, Math.PI * 2);
  ctx.arc(sx + 5, e.y - 18, 4, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = '#000';
  ctx.beginPath();
  ctx.arc(sx - 5, e.y - 18, 2, 0, Math.PI * 2);
  ctx.arc(sx + 5, e.y - 18, 2, 0, Math.PI * 2);
  ctx.fill();
  ctx.strokeStyle = '#000'; ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(sx - 9, e.y - 24); ctx.lineTo(sx - 2, e.y - 22);
  ctx.moveTo(sx + 9, e.y - 24); ctx.lineTo(sx + 2, e.y - 22);
  ctx.stroke();
  ctx.restore();
}

function drawPopups() {
  popups.forEach(p => {
    ctx.save();
    ctx.globalAlpha = p.life / 60;
    ctx.fillStyle = p.color;
    ctx.font = 'bold 13px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(p.text, p.x, p.y);
    ctx.restore();
  });
}

function draw() {
  ctx.fillStyle = '#0a0015';
  ctx.fillRect(0, 0, W, H);

  if (stars) stars.forEach(s => {
    s.tw += 0.05;
    ctx.globalAlpha = 0.4 + 0.6 * Math.abs(Math.sin(s.tw));
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc((s.x - scrollX * 0.2 + W * 4) % (W + 20), s.y, s.size, 0, Math.PI * 2); ctx.fill();
  });
  ctx.globalAlpha = 1;

  const grad = ctx.createLinearGradient(0, GROUND, 0, H);
  grad.addColorStop(0, '#4400aa'); grad.addColorStop(1, '#1a0044');
  ctx.fillStyle = grad; ctx.fillRect(0, GROUND, W, H - GROUND);
  ctx.strokeStyle = '#aa44ff'; ctx.lineWidth = 2;
  ctx.shadowColor = '#ff00ff'; ctx.shadowBlur = 8;
  ctx.beginPath(); ctx.moveTo(0, GROUND); ctx.lineTo(W, GROUND); ctx.stroke();
  ctx.shadowBlur = 0;

  if (platforms) platforms.forEach(pl => {
    const px = pl.x - scrollX;
    if (px > -pl.w && px < W + 10) {
      ctx.fillStyle = '#6622cc';
      ctx.shadowColor = '#aa44ff'; ctx.shadowBlur = 10;
      ctx.beginPath(); ctx.roundRect(px, pl.y, pl.w, pl.h, 4); ctx.fill();
      ctx.shadowBlur = 0;
    }
  });

  if (gameRunning) {
    drawPlayer();
    if (enemies) enemies.forEach(e => drawEnemy(e));
    drawPopups();
  }
}

function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }

function setupControls() {
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');
  const jumpBtn = document.getElementById('jumpBtn');
  function press(key, btn) { keys[key] = true; btn.classList.add('pressed'); }
  function release(key, btn) { keys[key] = false; btn.classList.remove('pressed'); }
  leftBtn.addEventListener('touchstart', e => { e.preventDefault(); press('left', leftBtn); });
  leftBtn.addEventListener('touchend',   e => { e.preventDefault(); release('left', leftBtn); });
  rightBtn.addEventListener('touchstart',e => { e.preventDefault(); press('right', rightBtn); });
  rightBtn.addEventListener('touchend',  e => { e.preventDefault(); release('right', rightBtn); });
  jumpBtn.addEventListener('touchstart', e => { e.preventDefault(); press('jump', jumpBtn); });
  jumpBtn.addEventListener('touchend',   e => { e.preventDefault(); release('jump', jumpBtn); });
  leftBtn.addEventListener('mousedown',  () => press('left', leftBtn));
  leftBtn.addEventListener('mouseup',    () => release('left', leftBtn));
  rightBtn.addEventListener('mousedown', () => press('right', rightBtn));
  rightBtn.addEventListener('mouseup',   () => release('right', rightBtn));
  jumpBtn.addEventListener('mousedown',  () => press('jump', jumpBtn));
  jumpBtn.addEventListener('mouseup',    () => release('jump', jumpBtn));
  document.addEventListener('keydown', e => {
    if (e.key==='ArrowLeft')  keys.left=true;
    if (e.key==='ArrowRight') keys.right=true;
    if (e.key==='ArrowUp'||e.key===' ') keys.jump=true;
  });
  document.addEventListener('keyup', e => {
    if (e.key==='ArrowLeft')  keys.left=false;
    if (e.key==='ArrowRight') keys.right=false;
    if (e.key==='ArrowUp'||e.key===' ') keys.jump=false;
  });
}

setupControls();
gameLoop();
</script>
</body>
</html>
